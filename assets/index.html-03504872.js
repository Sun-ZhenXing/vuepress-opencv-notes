import{_ as i,r,o as d,c as v,b as a,d as s,a as n,w as e,e as l}from"./app-b3e40293.js";const b={},u=a("h1",{id:"opencv-c-编译和构建指南",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#opencv-c-编译和构建指南","aria-hidden":"true"},"#"),s(" OpenCV C++ 编译和构建指南")],-1),k=a("h2",{id:"_1-基本编译指南",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#_1-基本编译指南","aria-hidden":"true"},"#"),s(" 1. 基本编译指南")],-1),_={href:"https://github.com/opencv/opencv/releases",target:"_blank",rel:"noopener noreferrer"},m=a("code",null,"opencv-4.7.0.zip",-1),h={href:"https://github.com/opencv/opencv_contrib/tags",target:"_blank",rel:"noopener noreferrer"},D=a("code",null,"opencv_contrib-4.7.0.zip",-1),F=a("div",{class:"language-bash","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"curl"),s(),a("span",{class:"token parameter variable"},"-Lj"),s(),a("span",{class:"token parameter variable"},"-o"),s(` opencv-4.7.0.zip https://github.com/opencv/opencv/archive/refs/tags/4.7.0.zip
`),a("span",{class:"token function"},"curl"),s(),a("span",{class:"token parameter variable"},"-Lj"),s(),a("span",{class:"token parameter variable"},"-o"),s(` opencv_contrib-4.7.0.zip https://github.com/opencv/opencv_contrib/archive/refs/tags/4.7.0.zip
`),a("span",{class:"token function"},"unzip"),s(" opencv-4.7.0.zip "),a("span",{class:"token parameter variable"},"-d"),s(),a("span",{class:"token builtin class-name"},"."),s(`
`),a("span",{class:"token function"},"unzip"),s(" opencv_contrib-4.7.0.zip "),a("span",{class:"token parameter variable"},"-d"),s(),a("span",{class:"token builtin class-name"},"."),s(`
`),a("span",{class:"token builtin class-name"},"cd"),s(` opencv-4.7.0
`),a("span",{class:"token function"},"mkdir"),s(),a("span",{class:"token parameter variable"},"-p"),s(` build
`)])])],-1),g=a("div",{class:"language-bash","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"curl"),s(),a("span",{class:"token parameter variable"},"-Lj"),s(),a("span",{class:"token parameter variable"},"-o"),s(` opencv-4.7.0.zip https://github.com/opencv/opencv/archive/refs/tags/4.7.0.zip
`),a("span",{class:"token function"},"curl"),s(),a("span",{class:"token parameter variable"},"-Lj"),s(),a("span",{class:"token parameter variable"},"-o"),s(` opencv_contrib-4.7.0.zip https://github.com/opencv/opencv_contrib/archive/refs/tags/4.7.0.zip
7z x opencv-4.7.0.zip
7z x opencv_contrib-4.7.0.zip
`),a("span",{class:"token builtin class-name"},"cd"),s(` opencv-4.7.0
md build
`)])])],-1),O=l(`<p>需要预先安装编译依赖，Windows 系统见下文。例如 Ubuntu 的基本依赖为：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> build-essential cmake <span class="token function">git</span> pkg-config libgtk-3-dev <span class="token punctuation">\\</span>
    libavcodec-dev libavformat-dev libswscale-dev libv4l-dev <span class="token punctuation">\\</span>
    libxvidcore-dev libx264-dev libjpeg-dev libpng-dev libtiff-dev <span class="token punctuation">\\</span>
    gfortran openexr libatlas-base-dev python3-dev python3-numpy <span class="token punctuation">\\</span>
    libtbb2 libtbb-dev libdc1394-22-dev libopenexr-dev <span class="token punctuation">\\</span>
    libgstreamer-plugins-base1.0-dev libgstreamer1.0-dev
</code></pre></div><p>CMake 配置：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> build
cmake <span class="token punctuation">..</span>
</code></pre></div><p>编译和安装：</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token function">make</span> <span class="token parameter variable">-j</span> <span class="token variable"><span class="token variable">$(</span>nproc<span class="token variable">)</span></span>

<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><h2 id="_2-构建-qt-支持" tabindex="-1"><a class="header-anchor" href="#_2-构建-qt-支持" aria-hidden="true">#</a> 2. 构建 Qt 支持</h2><p>如果需要编译基于 Qt 的图形界面，启用 <code>-D WITH_QT=ON</code> 来编译，例如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>cmake <span class="token parameter variable">-D</span> <span class="token assign-left variable">CMAKE_BUILD_TYPE</span><span class="token operator">=</span>RELEASE <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">CMAKE_INSTALL_PREFIX</span><span class="token operator">=</span>/usr/local/opencv470 <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">INSTALL_C_EXAMPLE</span><span class="token operator">=</span>OFF <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">BUILD_EXAMPLE</span><span class="token operator">=</span>OFF <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">OPENCV_EXTRA_MODULES_PATH</span><span class="token operator">=</span><span class="token punctuation">..</span>/opencv_contrib-4.7.0/modules <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">WITH_V4L</span><span class="token operator">=</span>ON <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">WITH_TBB</span><span class="token operator">=</span>ON <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">WITH_VTK</span><span class="token operator">=</span>ON <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">WITH_GTK</span><span class="token operator">=</span>ON <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">WITH_OPENMP</span><span class="token operator">=</span>ON <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">WITH_OPENGL</span><span class="token operator">=</span>ON <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">WITH_QT</span><span class="token operator">=</span>ON <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">BUILD_opencv_python3</span><span class="token operator">=</span>OFF <span class="token punctuation">\\</span>
    <span class="token parameter variable">-D</span> <span class="token assign-left variable">BUILD_TIFF</span><span class="token operator">=</span>ON <span class="token punctuation">..</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-windows-编译指南" tabindex="-1"><a class="header-anchor" href="#_3-windows-编译指南" aria-hidden="true">#</a> 3. Windows 编译指南</h2><p>Windows 编译要求：</p><ul><li>Visual Studio 2019，并安装 C++ 桌面开发基本组件</li><li>CMake GUI 版本，也可以完全使用命令行</li></ul><p>在配置过程中将会自动下载依赖。</p><p>建议配置项：</p><ul><li>CUDA 支持，如果安装了 CUDA 可选择支持，不过需要选择你的显卡对应的算力</li><li><code>BUILD_opencv_world</code> 编译包含所有库的动态链接库</li><li>Test 选项可去除</li><li>Python/Java/JS 选项去除</li></ul><div class="hint-container info"><p class="hint-container-title">使用代理</p><p>使用大陆的网络可能无法下载依赖，需要使用代理。在 Environment 中增加 <code>http_proxy</code> 和 <code>https_proxy</code> 变量，并将其指定为一个可用的代理地址。例如：</p><div class="language-yaml" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">http_proxy</span><span class="token punctuation">:</span> <span class="token string">&#39;http://127.0.0.1:10809&#39;</span>
<span class="token key atrule">https_proxy</span><span class="token punctuation">:</span> <span class="token string">&#39;socks5://127.0.0.1:10808&#39;</span>
</code></pre></div><p>在 Windows 上，Python 可能对 SOCKS 支持不完备，如果使用 SOCKS 协议时出现无法握手或者无法使用 DNS，将 <code>https_proxy</code> 代替为 <code>http_proxy</code> 的值即可：</p><div class="language-yaml" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">http_proxy</span><span class="token punctuation">:</span> <span class="token string">&#39;http://127.0.0.1:10809&#39;</span>
<span class="token key atrule">https_proxy</span><span class="token punctuation">:</span> <span class="token string">&#39;http://127.0.0.1:10809&#39;</span>
</code></pre></div></div><details class="hint-container details"><summary>命令行编译指南</summary><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>cmake <span class="token parameter variable">-G</span> <span class="token string">&quot;Visual Studio 16 2019&quot;</span> <span class="token parameter variable">-T</span> <span class="token assign-left variable">host</span><span class="token operator">=</span>x64 <span class="token parameter variable">-A</span> x64 ^
    <span class="token parameter variable">-DBUILD_DOCS</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_SHARED_LIBS</span><span class="token operator">=</span>ON ^
    <span class="token parameter variable">-DBUILD_FAT_JAVA_LIB</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_TESTS</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_TIFF</span><span class="token operator">=</span>ON ^
    <span class="token parameter variable">-DBUILD_JASPER</span><span class="token operator">=</span>ON ^
    <span class="token parameter variable">-DBUILD_JPEG</span><span class="token operator">=</span>ON ^
    <span class="token parameter variable">-DBUILD_PNG</span><span class="token operator">=</span>ON ^
    <span class="token parameter variable">-DBUILD_ZLIB</span><span class="token operator">=</span>ON ^
    <span class="token parameter variable">-DBUILD_OPENEXR</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_apps</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_calib3d</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_contrib</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_features2d</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_flann</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_gpu</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_java</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_legacy</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_ml</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_nonfree</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_objdetect</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_ocl</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_photo</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_python</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_stitching</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_superres</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_ts</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_video</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_videostab</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_world</span><span class="token operator">=</span>ON ^
    <span class="token parameter variable">-DBUILD_opencv_lengcy</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DBUILD_opencv_lengcy</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_1394</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_EIGEN</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_FFMPEG</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_GIGEAPI</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_GSTREAMER</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_GTK</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_PVAPI</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_V4L</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_LIBV4L</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_CUDA</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_CUFFT</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_OPENCL</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_OPENCLAMDBLAS</span><span class="token operator">=</span>OFF ^
    <span class="token parameter variable">-DWITH_OPENCLAMDFFT</span><span class="token operator">=</span>OFF <span class="token punctuation">..</span>
cmake <span class="token parameter variable">--build</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">--config</span> Release <span class="token parameter variable">--target</span> ALL_BUILD <span class="token parameter variable">-j</span> <span class="token number">20</span> --
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h2 id="_4-opencv-cuda-编译指南" tabindex="-1"><a class="header-anchor" href="#_4-opencv-cuda-编译指南" aria-hidden="true">#</a> 4. OpenCV CUDA 编译指南</h2><p>下面进行一份完整的 CUDA 支持的 OpenCV 编译过程，以 Windows 和 OpenCV 4.7.0 为例。</p><p>下面我的机器配置，请根据条件选择合适的配置项目：</p><table><thead><tr><th>配置项</th><th>值</th></tr></thead><tbody><tr><td>CPU</td><td>Intel(R) Core(TM) i9-12900H</td></tr><tr><td>GPU</td><td>NVIDIA RTX 3070 Ti Laptop GPU</td></tr><tr><td>显存</td><td>8 GB</td></tr><tr><td>内存</td><td>16 GB</td></tr><tr><td>CUDA</td><td>12.1</td></tr><tr><td>VS</td><td>Visual Studio 2019 Community</td></tr></tbody></table><p>打开 CMake-GUI，然后选择源码和编译目录。</p><p>配置 Environment，设置 <code>http_proxy</code> 和 <code>https_proxy</code> 为代理地址。</p><div class="language-yaml" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">http_proxy</span><span class="token punctuation">:</span> <span class="token string">&#39;http://127.0.0.1:10809&#39;</span>
<span class="token key atrule">https_proxy</span><span class="token punctuation">:</span> <span class="token string">&#39;http://127.0.0.1:10809&#39;</span>
</code></pre></div><p>点击 Configure，选择 Visual Studio 2019，然后点击 Finish。</p><p>第一次可选配置项：</p><table><thead><tr><th>配置项</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td><code>OPENCV_GENERATE_SETUPVARS</code></td><td><code>OFF</code></td><td>为了防止 <code>OpenCVGenSetupVars</code> 警告</td></tr><tr><td><code>BUILD_CUDA_STUBS</code></td><td><code>OFF</code></td><td>CUDA 桩库</td></tr><tr><td><code>WITH_CUDA</code></td><td><code>ON</code></td><td>CUDA</td></tr><tr><td><code>OPENCV_DNN_CUDA</code></td><td><code>ON</code></td><td>CUDA DNN</td></tr><tr><td><code>ENABLE_FAST_MATH</code></td><td><code>ON</code></td><td>快速数学库</td></tr><tr><td><code>BUILD_JAVA</code></td><td><code>OFF</code></td><td>Java 绑定</td></tr><tr><td><code>BUILD_opencv_java_bindings_generator</code></td><td><code>OFF</code></td><td>Java 绑定生成器</td></tr><tr><td><code>OPENCV_EXTRA_MODULES_PATH</code></td><td><code>D:/workspace/repo/opencv4.7/opencv_contrib-4.7.0/modules</code></td><td>额外模块路径，选择自己的下载位置</td></tr><tr><td><code>OPENCV_ENABLE_NONFREE</code></td><td><code>ON</code></td><td>非自由组件</td></tr><tr><td><code>BUILD_opencv_js</code></td><td><code>OFF</code></td><td>JS 绑定</td></tr><tr><td><code>BUILD_opencv_js_bindings_generator</code></td><td><code>OFF</code></td><td>JS 绑定生成器</td></tr><tr><td><code>BUILD_opencv_python3</code></td><td><code>OFF</code></td><td>Python3 绑定</td></tr><tr><td><code>BUILD_opencv_python_bindings_generator</code></td><td><code>OFF</code></td><td>Python3 绑定生成器</td></tr><tr><td><code>BUILD_opencv_python_tests</code></td><td><code>OFF</code></td><td>Python3 绑定测试</td></tr><tr><td><code>BUILD_opencv_objc_bindings_generator</code></td><td><code>OFF</code></td><td>Objective-C 绑定生成器</td></tr><tr><td><code>BUILD_opencv_world</code></td><td><code>ON</code></td><td>编译包含所有库的动态链接库</td></tr><tr><td><code>BUILD_SHARED_LIBS</code></td><td><code>ON</code></td><td>编译动态链接库，如果需要静态库请不要勾选</td></tr></tbody></table><p>如果需要 Python 绑定，则安装过程中将自动替换当前 Python 安装的 OpenCV，请谨慎选择。</p><p>根据需要选择即可，点击 Configure。</p>`,29),I={href:"https://developer.nvidia.com/cuda-gpus#compute",target:"_blank",rel:"noopener noreferrer"},L=a("strong",null,"CUDA-Enabled GeForce and TITAN Products",-1),U=l("<p>第二次可选配置项：</p><table><thead><tr><th>配置项</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td><code>CUDA_FAST_MATH</code></td><td><code>ON</code></td><td>快速数学库</td></tr><tr><td><code>CUDA_ARCH_BIN</code></td><td><code>7.5;8.6</code></td><td>显卡算力，此值兼容 20/30 系多数显卡</td></tr><tr><td><code>WITH_FREETYPE</code></td><td><code>OFF</code></td><td>FreeType 字体库</td></tr></tbody></table><p>点击 Configure，然后点击 Generate。此时将生成 Visual Studio 2019 的解决方案。</p><p>打开 <code>OpenCV.sln</code>，然后选择 Release 模式，右键资源管理器中的 <code>ALL_BUILD</code> 项目，然后选择生成。</p><p>此过程较长，请耐心等待，如果没有显示错误则生成成功。成功后右键 <code>INSTALL</code> 项目，然后选择生成。</p><p>生成目标默认安装在项目的 <code>install</code> 目录下，可以在 CMake-GUI 中修改。</p>",6);function B(T,f){const t=r("ExternalLinkIcon"),c=r("CodeTabs");return d(),v("div",null,[u,k,a("p",null,[s("下面都以 OpenCV 4.7.0 的编译为例。下载源代码 "),a("a",_,[m,n(t)]),s(" 和 "),a("a",h,[D,n(t)]),s("，解压到同一个文件夹。")]),n(c,{id:"9",data:[{id:"Linux"},{id:"Windows"}]},{title0:e(({value:p,isActive:o})=>[s("Linux")]),title1:e(({value:p,isActive:o})=>[s("Windows")]),tab0:e(({value:p,isActive:o})=>[F]),tab1:e(({value:p,isActive:o})=>[g]),_:1}),O,a("p",null,[s("查看显卡算力可以在 "),a("a",I,[s("NVIDIA 开发者官网"),n(t)]),s(" 的算力表，在 "),L,s(" 一栏可以看到 GeForce 系列的算力，例如 RTX 3070 Ti Laptop GPU 的算力为 8.6。")]),U])}const E=i(b,[["render",B],["__file","index.html.vue"]]);export{E as default};
