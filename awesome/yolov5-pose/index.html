<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.67">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/vuepress-opencv-notes/favicon.svg"><title>使用 YOLOv5 进行姿态估计和行为检测 | OpenCV 笔记合集</title><meta name="description" content="使用 C++ 和 Python 编写现代 OpenCV 应用">
    <link rel="preload" href="/vuepress-opencv-notes/assets/style-3339a9ed.css" as="style"><link rel="stylesheet" href="/vuepress-opencv-notes/assets/style-3339a9ed.css">
    <link rel="modulepreload" href="/vuepress-opencv-notes/assets/app-e9203006.js"><link rel="modulepreload" href="/vuepress-opencv-notes/assets/index.html-c207a7e6.js"><link rel="modulepreload" href="/vuepress-opencv-notes/assets/index.html-b8ebe650.js"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-1c6ed00b.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-3a3a2443.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-6f5caa16.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-8163f4f8.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-8b76cbf1.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/cv2-support-unicode.html-d8c08c78.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-f1f9b7c3.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/use-vscode.html-ecf33c4d.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-cfe37326.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-44c7d432.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-47045445.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-4a70d62e.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-07561acb.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-ef4707b8.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-60ad645b.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-152272c5.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-d7bbc7e4.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-d85472f6.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-dbc6f2eb.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-cc4d109b.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-82b2939f.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-037413c2.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-e1c6fabc.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-6d08ba93.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-1deb8616.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-c37d3383.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-1b835ee0.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-0b4069c0.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-7056b49e.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-b131da15.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-fab0574d.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-0dd5dab5.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-d5a74096.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-b224e16b.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-da0f48ea.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-60288c6d.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-e7f1fa12.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-669cdc4b.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-80351804.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-ff547d37.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-762c060c.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-263bc852.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/cv2-support-unicode.html-fdc8e2e1.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-09007755.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/use-vscode.html-736fc06a.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-45fb1de7.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-0de3341c.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-36a98ba7.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-8cd93f8c.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-ee9278f2.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-d796fc2a.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-c3e93be5.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-0c1ac2a1.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-5fd8d09b.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-3b0ae8ea.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-7e90e318.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-36815a14.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-7c84ff45.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-5b4de715.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-8a23f138.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-f867c815.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-12f6d731.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-648c4360.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-854181cc.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-983cc680.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-540cb476.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-9f6956cd.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-534f3885.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-00e55e19.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-3a76f107.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-96335a2f.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-8f0f9db7.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-197dae4b.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index.html-86a891e4.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/404.html-3a6b4c97.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/mermaid.core-c80b3698.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/copy-tex.min-a72ade3f.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/vuepress-opencv-notes/assets/index-82585c84.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/vuepress-opencv-notes/" class=""><img class="logo" src="/vuepress-opencv-notes/favicon.svg" alt="OpenCV 笔记合集"><span class="site-name can-hide">OpenCV 笔记合集</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/Sun-ZhenXing/vuepress-opencv-notes/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="切换颜色模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/Sun-ZhenXing/vuepress-opencv-notes/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="使用-yolov5-进行姿态估计和行为检测" tabindex="-1"><a class="header-anchor" href="#使用-yolov5-进行姿态估计和行为检测" aria-hidden="true">#</a> 使用 YOLOv5 进行姿态估计和行为检测</h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/vuepress-opencv-notes/awesome/yolov5-pose/#1-姿态估计和行为检测概述" class="router-link-active router-link-exact-active">1. 姿态估计和行为检测概述</a></li><li><a aria-current="page" href="/vuepress-opencv-notes/awesome/yolov5-pose/#2-姿态估计的方法" class="router-link-active router-link-exact-active">2. 姿态估计的方法</a></li><li><a aria-current="page" href="/vuepress-opencv-notes/awesome/yolov5-pose/#2-yolov5-姿态估计" class="router-link-active router-link-exact-active">2. YOLOv5 姿态估计</a></li><li><a aria-current="page" href="/vuepress-opencv-notes/awesome/yolov5-pose/#3-行为分类" class="router-link-active router-link-exact-active">3. 行为分类</a></li></ul></nav><h2 id="1-姿态估计和行为检测概述" tabindex="-1"><a class="header-anchor" href="#1-姿态估计和行为检测概述" aria-hidden="true">#</a> 1. 姿态估计和行为检测概述</h2><p><strong>行为识别</strong>（Action Recognition）是指对视频中人的行为动作进行识别。行为识别是一项具有挑战性的任务，受光照条件各异、视角多样性、背景复杂、类内变化大等诸多因素的影响。<sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup></p><p>对行为识别的研究可以追溯到 1973 年，Johansson 通过实验观察发现，人体的运动可以通过一些主要关节点的移动来描述<sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup>。因此，只要 10-12 个关键节点的组合与追踪便能形成对诸多行为例如跳舞、走路、跑步等的刻画，做到通过人体关键节点的运动来识别行为。</p><p><strong>姿态估计</strong>（Pose Estimation）是指检测图像和视频中的人物形象的计算机视觉技术，可以确定某人的某个身体部位出现在图像中的位置，也就是在图像和视频中对人体关节的定位问题，也可以理解为在所有关节姿势的空间中搜索特定姿势。简言之，姿态估计的任务就是重建人的关节和肢干。<sup class="footnote-ref"><a href="#footnote3">[3]</a><a class="footnote-anchor" id="footnote-ref3"></a></sup></p><p>姿态估计可输出一个高维的姿态向量表示关节点的位置，即一整组关节点的定位，从图像背景中分离出人体前景，然后重建人物的关节、肢体，以便作为行为识别的输入，进行动作的识别，如跑步，跳跃等。</p><p>当我们使用姿态估计的结果时，行为识别可认为是典型的分类问题。姿态估计得到了特征点在图片中的位置信息，这些信息可全部进行归一化，然后利用最流行的分类器来对行为进行分类。</p><h2 id="2-姿态估计的方法" tabindex="-1"><a class="header-anchor" href="#2-姿态估计的方法" aria-hidden="true">#</a> 2. 姿态估计的方法</h2><p>目前人体姿态估计总体分为 Top-down 和 Bottom-up 两种，与目标检测不同，无论是基于热力图或是基于检测器处理的关键点检测算法，都较为依赖计算资源，推理耗时略长，2022 年出现了以 YOLO 为基线的关键点检测器。<sup class="footnote-ref"><a href="#footnote4">[4]</a><a class="footnote-anchor" id="footnote-ref4"></a></sup></p><p>在 ECCV 2022 和 CVPRW 2022 会议上，YoLo-Pose 和 KaPao 都基于流行的 YOLO 目标检测框架提出一种新颖的无热力图的方法<sup class="footnote-ref"><a href="#footnote4">[4:1]</a><a class="footnote-anchor" id="footnote-ref4:1"></a></sup><sup class="footnote-ref"><a href="#footnote5">[5]</a><a class="footnote-anchor" id="footnote-ref5"></a></sup>，YOLO 类型的姿态估计方法不使用检测器进行二阶处理，也不使用使用热力图拼接，虽然是一种暴力回归关键点的检测算法，但在处理速度上具有一定优势。</p><p>对于人的姿势估计，它可以归结为一个单个类别检测器（对于人）。每个人有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>17</mn></mrow><annotation encoding="application/x-tex">17</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">17</span></span></span></span> 个关键点，而每个关键点又被确定为识别位置和置信度。因此，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>17</mn></mrow><annotation encoding="application/x-tex">17</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">17</span></span></span></span> 个关键点有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>51</mn></mrow><annotation encoding="application/x-tex">51</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">51</span></span></span></span> 个元素与一个锚点（anchor）。因此，对于每个锚点需要预测 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>51</mn></mrow><annotation encoding="application/x-tex">51</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">51</span></span></span></span> 个元素，预测框需要 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span></span></span></span> 个元素。对于一个有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个关键点的锚，整个预测向量被定义为</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>P</mi><mi>v</mi></msub><mo>=</mo><mo stretchy="false">{</mo><msub><mi>C</mi><mi>x</mi></msub><mo separator="true">,</mo><mtext> </mtext><msub><mi>C</mi><mi>y</mi></msub><mo separator="true">,</mo><mtext> </mtext><mi>W</mi><mo separator="true">,</mo><mtext> </mtext><mi>H</mi><mo separator="true">,</mo><mtext> </mtext><msub><mrow><mi mathvariant="normal">b</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">x</mi></mrow><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>f</mi></mrow></msub><mo separator="true">,</mo><mtext> </mtext><msub><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">s</mi></mrow><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>f</mi></mrow></msub><mo separator="true">,</mo><mtext> </mtext><msubsup><mi>K</mi><mi>x</mi><mn>1</mn></msubsup><mo separator="true">,</mo><mtext> </mtext><msubsup><mi>K</mi><mi>y</mi><mn>1</mn></msubsup><mo separator="true">,</mo><mtext> </mtext><msubsup><mi>K</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>f</mi></mrow><mn>1</mn></msubsup><mo separator="true">,</mo><mtext> </mtext><mo>…</mo><mo separator="true">,</mo><mtext> </mtext><msubsup><mi>K</mi><mi>x</mi><mi>n</mi></msubsup><mo separator="true">,</mo><mtext> </mtext><msubsup><mi>K</mi><mi>y</mi><mi>n</mi></msubsup><mo separator="true">,</mo><mtext> </mtext><msubsup><mi>K</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>f</mi></mrow><mi>n</mi></msubsup><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex"> P_v = \{ C_x,\,C_y,\,W,\,H,\,\mathrm{box}_{conf},\,\mathrm{class}_{conf},\,K^1_x,\,K^1_y,\,K^1_{conf},\,\dots,\,K^n_x,\,K^n_y,\,K^n_{conf} \} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2472em;vertical-align:-0.3831em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">box</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">class</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span></p><p>YOLO-Pose 使用的数据集是 Keypoints Labels of MS COCO 2017，数据集中每一行表示一个人的姿态标注。第一个值恒为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>，表示类别为人。后面的四个值分别是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo separator="true">,</mo><mtext> </mtext><mi>y</mi></mrow><annotation encoding="application/x-tex">x,\,y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 和宽高的归一化值，接下来是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>17</mn></mrow><annotation encoding="application/x-tex">17</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">17</span></span></span></span> 个关键点的位置。每一个关键点是一个长度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span> 的数组，第一和第二个元素分别是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> 归一化坐标值，第三个元素是个标志位 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> 为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 时表示这个关键点没有标注（这种情况下 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mi>y</mi><mo>=</mo><mi>v</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x=y=v=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>），<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> 为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 时表示这个关键点标注了但是不可见（被遮挡了），<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> 为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> 时表示这个关键点标注了同时也可见。</p><p>网络中每一个锚点（anchor）的输出值是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>v</mi></msub></mrow><annotation encoding="application/x-tex">P_v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，对于 YOLO，通常使用非极大值抑制来获取最终的输出结果。也就是说，我们最终会得到一个人的目标框和关键点信息。我们取所有关键点信息的归一化值来给下面的行为检测器使用。我们提取人的检测框，并使用检测框对 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>17</mn></mrow><annotation encoding="application/x-tex">17</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">17</span></span></span></span> 个关键点进行归一化，这样我们就得到了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>51</mn></mrow><annotation encoding="application/x-tex">51</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">51</span></span></span></span> 维度的训练数据。</p><p>现在 YOLOv7 Pose<sup class="footnote-ref"><a href="#footnote6">[6]</a><a class="footnote-anchor" id="footnote-ref6"></a></sup> 和 YOLOv8<sup class="footnote-ref"><a href="#footnote7">[7]</a><a class="footnote-anchor" id="footnote-ref7"></a></sup> 都已经实现了这个算法，并且提供了相应的预训练模型。后续将提供相应的代码示例。</p><h2 id="2-yolov5-姿态估计" tabindex="-1"><a class="header-anchor" href="#2-yolov5-姿态估计" aria-hidden="true">#</a> 2. YOLOv5 姿态估计</h2><p><a href="http://software-dl.ti.com/jacinto7/esd/modelzoo/gplv3/latest/edgeai-yolov5/pretrained_models/models/keypoint/coco/edgeai-yolov5/yolov5s6_pose_640_ti_lite_54p9_82p2.onnx" target="_blank" rel="noopener noreferrer">下载 ONNX 预训练模型<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>，得到文件 <code>yolov5s6_pose_640_ti_lite_54p9_82p2.onnx</code>。</p><p>下面使用 ONNX Runtime 进行推理。</p><details class="hint-container details"><summary>查看代码</summary><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> cv2</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> numpy </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> np</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> onnxruntime</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">_CLASS_COLOR_MAP = [</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">),  </span><span style="color:#6A9955;"># Person (blue).</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),  </span><span style="color:#6A9955;"># Bear (red).</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),  </span><span style="color:#6A9955;"># Tree (lime).</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">),  </span><span style="color:#6A9955;"># Bird (fuchsia).</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">),  </span><span style="color:#6A9955;"># Sky (aqua).bbbbbbb</span></span>
<span class="line"><span style="color:#D4D4D4;">    (</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">),  </span><span style="color:#6A9955;"># Cat (yellow).</span></span>
<span class="line"><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">palette = np.array(</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">128</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">153</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">51</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">178</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">102</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">230</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">230</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">153</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">153</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">204</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">102</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">51</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">102</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">178</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">51</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">153</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">153</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">153</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">102</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">102</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">51</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">51</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">153</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">153</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">102</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">102</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">51</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">51</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    ]</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">skeleton = [</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">14</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">14</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">12</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">17</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">15</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">15</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">13</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">12</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">13</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">12</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">7</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">13</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">7</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">8</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">7</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">8</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">11</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">7</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">pose_limb_color = palette[</span></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">7</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">7</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">7</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">pose_kpt_color = palette[[</span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">16</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">9</span><span style="color:#D4D4D4;">]]</span></span>
<span class="line"><span style="color:#D4D4D4;">radius = </span><span style="color:#B5CEA8;">5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">_cache_session = </span><span style="color:#569CD6;">None</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">preprocess_image</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">img</span><span style="color:#D4D4D4;">: np.ndarray, </span><span style="color:#9CDCFE;">img_mean</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">img_scale</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;"> / </span><span style="color:#B5CEA8;">255</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)</span></span>
<span class="line"><span style="color:#D4D4D4;">    img = cv2.resize(img, (</span><span style="color:#B5CEA8;">640</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">640</span><span style="color:#D4D4D4;">), </span><span style="color:#9CDCFE;">interpolation</span><span style="color:#D4D4D4;">=cv2.INTER_LINEAR)</span></span>
<span class="line"><span style="color:#D4D4D4;">    img = (img - img_mean) * img_scale</span></span>
<span class="line"><span style="color:#D4D4D4;">    img = np.asarray(img, </span><span style="color:#9CDCFE;">dtype</span><span style="color:#D4D4D4;">=np.float32)</span></span>
<span class="line"><span style="color:#D4D4D4;">    img = np.expand_dims(img, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    img = img.transpose(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> img</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">model_inference</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">model_path</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;./yolov7-w6-pose.onnx&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">input</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">global</span><span style="color:#D4D4D4;"> _cache_session</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> _cache_session </span><span style="color:#569CD6;">is</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">        _cache_session = onnxruntime.InferenceSession(model_path, </span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    input_name = _cache_session.get_inputs()[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">].name</span></span>
<span class="line"><span style="color:#D4D4D4;">    output = _cache_session.run([], {input_name: </span><span style="color:#DCDCAA;">input</span><span style="color:#D4D4D4;">})</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> output</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">post_process</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">img</span><span style="color:#D4D4D4;">: np.ndarray, </span><span style="color:#9CDCFE;">output</span><span style="color:#D4D4D4;">: np.ndarray, </span><span style="color:#9CDCFE;">score_threshold</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">0.3</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    h, w, _ = img.shape</span></span>
<span class="line"><span style="color:#D4D4D4;">    img = cv2.resize(img, (</span><span style="color:#B5CEA8;">640</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">640</span><span style="color:#D4D4D4;">), </span><span style="color:#9CDCFE;">interpolation</span><span style="color:#D4D4D4;">=cv2.INTER_LINEAR)</span></span>
<span class="line"><span style="color:#D4D4D4;">    det_bboxes, det_scores, det_labels, kpts = (</span></span>
<span class="line"><span style="color:#D4D4D4;">        output[:, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">:</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        output[:, </span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        output[:, </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">        output[:, </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">:],</span></span>
<span class="line"><span style="color:#D4D4D4;">    )</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> idx </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">range</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">len</span><span style="color:#D4D4D4;">(det_bboxes)):</span></span>
<span class="line"><span style="color:#D4D4D4;">        det_bbox = det_bboxes[idx]</span></span>
<span class="line"><span style="color:#D4D4D4;">        kpt = kpts[idx]</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;"># print(det_labels[idx], kpt, det_bbox)</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> det_scores[idx] &gt; score_threshold:</span></span>
<span class="line"><span style="color:#D4D4D4;">            color_map = _CLASS_COLOR_MAP[</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(det_labels[idx])]</span></span>
<span class="line"><span style="color:#D4D4D4;">            img = cv2.rectangle(</span></span>
<span class="line"><span style="color:#D4D4D4;">                img,</span></span>
<span class="line"><span style="color:#D4D4D4;">                (</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(det_bbox[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">]), </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(det_bbox[</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">])),</span></span>
<span class="line"><span style="color:#D4D4D4;">                (</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(det_bbox[</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">]), </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(det_bbox[</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">])),</span></span>
<span class="line"><span style="color:#D4D4D4;">                color_map[::-</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">            )</span></span>
<span class="line"><span style="color:#D4D4D4;">            cv2.putText(</span></span>
<span class="line"><span style="color:#D4D4D4;">                img,</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#CE9178;">&quot;id:</span><span style="color:#569CD6;">{}</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">.format(</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(det_labels[idx])),</span></span>
<span class="line"><span style="color:#D4D4D4;">                (</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(det_bbox[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">] + </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">), </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(det_bbox[</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">]) + </span><span style="color:#B5CEA8;">15</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">                cv2.FONT_HERSHEY_SIMPLEX,</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">                color_map[::-</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">            )</span></span>
<span class="line"><span style="color:#D4D4D4;">            cv2.putText(</span></span>
<span class="line"><span style="color:#D4D4D4;">                img,</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#CE9178;">&quot;score:</span><span style="color:#569CD6;">{:2.1f}</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">.format(det_scores[idx]),</span></span>
<span class="line"><span style="color:#D4D4D4;">                (</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(det_bbox[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">] + </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">), </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(det_bbox[</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">]) + </span><span style="color:#B5CEA8;">30</span><span style="color:#D4D4D4;">),</span></span>
<span class="line"><span style="color:#D4D4D4;">                cv2.FONT_HERSHEY_SIMPLEX,</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">                color_map[::-</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">            )</span></span>
<span class="line"><span style="color:#D4D4D4;">            plot_skeleton_kpts(img, kpt)</span></span>
<span class="line"><span style="color:#D4D4D4;">    img = cv2.resize(img, (w, h), </span><span style="color:#9CDCFE;">interpolation</span><span style="color:#D4D4D4;">=cv2.INTER_LINEAR)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> img, kpts</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">plot_skeleton_kpts</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">img</span><span style="color:#D4D4D4;">: np.ndarray, </span><span style="color:#9CDCFE;">kpts</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">steps</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    num_kpts = </span><span style="color:#DCDCAA;">len</span><span style="color:#D4D4D4;">(kpts) // steps</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;"># plot keypoints</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> kid </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">range</span><span style="color:#D4D4D4;">(num_kpts):</span></span>
<span class="line"><span style="color:#D4D4D4;">        r, g, b = pose_kpt_color[kid]</span></span>
<span class="line"><span style="color:#D4D4D4;">        x_coord, y_coord = kpts[steps * kid], kpts[steps * kid + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">        conf = kpts[steps * kid + </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> conf &gt; </span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">:  </span><span style="color:#6A9955;"># Confidence of a keypoint has to be greater than 0.5</span></span>
<span class="line"><span style="color:#D4D4D4;">            cv2.circle(</span></span>
<span class="line"><span style="color:#D4D4D4;">                img, (</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(x_coord), </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(y_coord)), radius, (</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(r), </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(g), </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(b)), -</span><span style="color:#B5CEA8;">1</span></span>
<span class="line"><span style="color:#D4D4D4;">            )</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;"># plot skeleton</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> sk_id, sk </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">enumerate</span><span style="color:#D4D4D4;">(skeleton):</span></span>
<span class="line"><span style="color:#D4D4D4;">        r, g, b = pose_limb_color[sk_id]</span></span>
<span class="line"><span style="color:#D4D4D4;">        pos1 = (</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(kpts[(sk[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">] - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) * steps]), </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(kpts[(sk[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">] - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) * steps + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">]))</span></span>
<span class="line"><span style="color:#D4D4D4;">        pos2 = (</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(kpts[(sk[</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">] - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) * steps]), </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(kpts[(sk[</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">] - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) * steps + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">]))</span></span>
<span class="line"><span style="color:#D4D4D4;">        conf1 = kpts[(sk[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">] - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) * steps + </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">        conf2 = kpts[(sk[</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">] - </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) * steps + </span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span></span>
<span class="line"><span style="color:#D4D4D4;">            conf1 &gt; </span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">and</span><span style="color:#D4D4D4;"> conf2 &gt; </span><span style="color:#B5CEA8;">0.5</span></span>
<span class="line"><span style="color:#D4D4D4;">        ):  </span><span style="color:#6A9955;"># For a limb, both the keypoint confidence must be greater than 0.5</span></span>
<span class="line"><span style="color:#D4D4D4;">            cv2.line(img, pos1, pos2, (</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(r), </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(g), </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(b)), </span><span style="color:#9CDCFE;">thickness</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">infer_video</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">video_path</span><span style="color:#D4D4D4;">: </span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;"> | </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    cap = cv2.VideoCapture(video_path)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">not</span><span style="color:#D4D4D4;"> cap.isOpened():</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error opening video stream or file&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">return</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">while</span><span style="color:#D4D4D4;"> cap.isOpened():</span></span>
<span class="line"><span style="color:#D4D4D4;">        ret, frame = cap.read()</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> ret:</span></span>
<span class="line"><span style="color:#D4D4D4;">            img = preprocess_image(frame)</span></span>
<span class="line"><span style="color:#D4D4D4;">            output = model_inference(</span><span style="color:#9CDCFE;">input</span><span style="color:#D4D4D4;">=img)[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">            res, kpts = post_process(frame, output)</span></span>
<span class="line"><span style="color:#D4D4D4;">            cv2.imshow(</span><span style="color:#CE9178;">&quot;frame&quot;</span><span style="color:#D4D4D4;">, res)</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> cv2.waitKey(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) &amp; </span><span style="color:#569CD6;">0x</span><span style="color:#B5CEA8;">FF</span><span style="color:#D4D4D4;"> == </span><span style="color:#DCDCAA;">ord</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;q&quot;</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#C586C0;">break</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">break</span></span>
<span class="line"><span style="color:#D4D4D4;">    cap.release()</span></span>
<span class="line"><span style="color:#D4D4D4;">    cv2.destroyAllWindows()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">build_train_data</span><span style="color:#D4D4D4;">():</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> pandas </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> pd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    cols = []</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> p </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">range</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">18</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">        cols.append(</span><span style="color:#CE9178;">&quot;x</span><span style="color:#569CD6;">{}</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">.format(p))</span></span>
<span class="line"><span style="color:#D4D4D4;">        cols.append(</span><span style="color:#CE9178;">&quot;y</span><span style="color:#569CD6;">{}</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">.format(p))</span></span>
<span class="line"><span style="color:#D4D4D4;">        cols.append(</span><span style="color:#CE9178;">&quot;c</span><span style="color:#569CD6;">{}</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">.format(p))</span></span>
<span class="line"><span style="color:#D4D4D4;">    data = pd.DataFrame(</span><span style="color:#9CDCFE;">columns</span><span style="color:#D4D4D4;">=cols)</span></span>
<span class="line"><span style="color:#D4D4D4;">    i = </span><span style="color:#B5CEA8;">0</span></span>
<span class="line"><span style="color:#D4D4D4;">    data_path = </span><span style="color:#CE9178;">&quot;train&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> f </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> os.listdir(</span><span style="color:#569CD6;">f</span><span style="color:#CE9178;">&quot;./data/</span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">data_path</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">        img_src = cv2.imread(</span><span style="color:#569CD6;">f</span><span style="color:#CE9178;">&quot;./data/</span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">data_path</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;">/</span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">f</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">        img = preprocess_image(img_src)</span></span>
<span class="line"><span style="color:#D4D4D4;">        output = model_inference(</span><span style="color:#9CDCFE;">input</span><span style="color:#D4D4D4;">=img)[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">        res, kpts = post_process(img_src, output)</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> kpts.size &gt; </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">            data.loc[i] = kpts[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">]  </span><span style="color:#6A9955;"># type: ignore</span></span>
<span class="line"><span style="color:#D4D4D4;">            i += </span><span style="color:#B5CEA8;">1</span></span>
<span class="line"><span style="color:#D4D4D4;">        cv2.imshow(</span><span style="color:#CE9178;">&quot;frame&quot;</span><span style="color:#D4D4D4;">, res)</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> cv2.waitKey(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) &amp; </span><span style="color:#569CD6;">0x</span><span style="color:#B5CEA8;">FF</span><span style="color:#D4D4D4;"> == </span><span style="color:#DCDCAA;">ord</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;q&quot;</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">None</span></span>
<span class="line"><span style="color:#D4D4D4;">    data.to_csv(</span><span style="color:#569CD6;">f</span><span style="color:#CE9178;">&quot;./data/</span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">data_path</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;">.csv&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">index</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">False</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">main</span><span style="color:#D4D4D4;">():</span></span>
<span class="line"><span style="color:#D4D4D4;">    infer_video(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;"># build_train_data()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">__name__</span><span style="color:#D4D4D4;"> == </span><span style="color:#CE9178;">&quot;__main__&quot;</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    main()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p>如果我们需要对每个关键点基于检测框进行归一化，可以在 <code>post_process</code> 函数中添加如下代码：</p><div class="language-python" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> kpts.size &gt; </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    det_bbox = det_bboxes[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">    x1, y1, x2, y2 = </span><span style="color:#DCDCAA;">map</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">, det_bbox)</span></span>
<span class="line"><span style="color:#D4D4D4;">    w, h = x2 - x1, y2 - y1</span></span>
<span class="line"><span style="color:#D4D4D4;">    kpts[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">::</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">] = (kpts[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">::</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">] - x1) / w</span></span>
<span class="line"><span style="color:#D4D4D4;">    kpts[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">::</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">] = (kpts[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">::</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">] - y1) / h</span></span>
<span class="line"></span></code></pre></div><p>如果需要推理某个文件夹下的全部文件，修改 <code>build_train_data</code> 函数，最终会构建 CSV 文件。</p><h2 id="3-行为分类" tabindex="-1"><a class="header-anchor" href="#3-行为分类" aria-hidden="true">#</a> 3. 行为分类</h2><p>有了关键点数据，我们就可以对行为进行分类。我们可以使用 <a href="https://www.kaggle.com/datasets/niharika41298/yoga-poses-dataset" target="_blank" rel="noopener noreferrer">Kaggle 瑜伽姿态数据集<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>，这个数据集包含了 5 种不同的瑜伽姿势，每种姿势有 100~200 个样本<sup class="footnote-ref"><a href="#footnote8">[8]</a><a class="footnote-anchor" id="footnote-ref8"></a></sup>。我们可以使用 SVM 分类器来对这些数据进行分类。</p><p>SVM 分类器的工作流程如下：</p><ol><li>收集训练数据集：收集一组已经标记好的训练数据集，其中每个样本都有一个标签，表示它所属的类别。</li><li>特征提取：从每个样本中提取出一组特征向量，用于描述该样本的特征。</li><li>标准化：对特征向量进行标准化处理，使其在数值上具有相同的尺度。</li><li>寻找最优超平面：通过求解一个优化问题，找到一个最优的超平面，使得该超平面能够将不同类别的样本分开，并且在两侧的分类边界上的距离最大。</li><li>核函数选择：如果数据集不是线性可分的，需要使用核函数将数据映射到高维空间中，使其成为线性可分的。</li><li>参数调优：选择合适的参数，如正则化参数和核函数参数，以达到更好的分类效果。</li><li>模型评估：使用测试数据集对模型进行评估，检验其泛化能力。</li><li>应用模型：将训练好的模型应用于新的未知数据进行分类。</li></ol><p>依据上面的流程，我们设计的训练流程如下：</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><p>由摄像机提取的图像帧数据经过预处理后经过 YOLOv7-Pose 网络检测后，得到每一个图像的特征点数据，然后降维到低维度后训练 SVM 分类器，通过 SVM 分类器实现行为检测，从而判断具体行为。</p><p>下面是一个二分类的示例，用于分类摔倒和没有摔倒的图片，预处理方式相似，需要对检测框进行归一化，请参考上方代码，将数据保存为 CSV 文件。使用网格搜索查找最优参数，训练后绘制混淆矩阵，并打印准确率、精度、召回率和 F1 值。</p><details class="hint-container details"><summary>SVM 分类器示例</summary><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> joblib</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> matplotlib.pyplot </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> plt</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> pandas </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> pd</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> seaborn </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> sns</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> sklearn.metrics </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> classification_report, confusion_matrix</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> sklearn.model_selection </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> GridSearchCV</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> sklearn.svm </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> SVC</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Data</span></span>
<span class="line"><span style="color:#D4D4D4;">data_fall = pd.read_csv(</span><span style="color:#CE9178;">&quot;data/fall.csv&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">data_nofall = pd.read_csv(</span><span style="color:#CE9178;">&quot;data/nofall.csv&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Data Preprocessing</span></span>
<span class="line"><span style="color:#D4D4D4;">data_fall[</span><span style="color:#CE9178;">&quot;label&quot;</span><span style="color:#D4D4D4;">] = </span><span style="color:#B5CEA8;">1</span></span>
<span class="line"><span style="color:#D4D4D4;">data_nofall[</span><span style="color:#CE9178;">&quot;label&quot;</span><span style="color:#D4D4D4;">] = </span><span style="color:#B5CEA8;">0</span></span>
<span class="line"><span style="color:#D4D4D4;">data = pd.concat([data_fall, data_nofall], </span><span style="color:#9CDCFE;">ignore_index</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">data = data.dropna()</span></span>
<span class="line"><span style="color:#D4D4D4;">data = data.sample(</span><span style="color:#9CDCFE;">frac</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">).reset_index(</span><span style="color:#9CDCFE;">drop</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">data = data.astype(</span><span style="color:#CE9178;">&quot;float64&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Split data</span></span>
<span class="line"><span style="color:#D4D4D4;">X = data.drop(</span><span style="color:#CE9178;">&quot;label&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">axis</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">y = data[</span><span style="color:#CE9178;">&quot;label&quot;</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">X_train = X[: </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">len</span><span style="color:#D4D4D4;">(X) * </span><span style="color:#B5CEA8;">0.8</span><span style="color:#D4D4D4;">)]</span></span>
<span class="line"><span style="color:#D4D4D4;">X_test = X[</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">len</span><span style="color:#D4D4D4;">(X) * </span><span style="color:#B5CEA8;">0.8</span><span style="color:#D4D4D4;">) :]</span></span>
<span class="line"><span style="color:#D4D4D4;">y_train = y[: </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">len</span><span style="color:#D4D4D4;">(y) * </span><span style="color:#B5CEA8;">0.8</span><span style="color:#D4D4D4;">)]</span></span>
<span class="line"><span style="color:#D4D4D4;">y_test = y[</span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">len</span><span style="color:#D4D4D4;">(y) * </span><span style="color:#B5CEA8;">0.8</span><span style="color:#D4D4D4;">) :]</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(X, y)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># SVM</span></span>
<span class="line"><span style="color:#D4D4D4;">svm = SVC(</span><span style="color:#9CDCFE;">kernel</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;rbf&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">C</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">gamma</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">0.001</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">svm.fit(X_train, y_train)</span></span>
<span class="line"><span style="color:#D4D4D4;">y_pred = svm.predict(X_test)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Evaluation</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(confusion_matrix(y_test, y_pred))</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(classification_report(y_test, y_pred))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Plot</span></span>
<span class="line"><span style="color:#D4D4D4;">sns.heatmap(confusion_matrix(y_test, y_pred), </span><span style="color:#9CDCFE;">annot</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">cmap</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;Blues&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">plt.show()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Grid Search</span></span>
<span class="line"><span style="color:#D4D4D4;">param_grid = {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;C&quot;</span><span style="color:#D4D4D4;">: [</span><span style="color:#B5CEA8;">0.1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;gamma&quot;</span><span style="color:#D4D4D4;">: [</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0.1</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0.01</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0.001</span><span style="color:#D4D4D4;">, </span><span style="color:#B5CEA8;">0.0001</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&quot;kernel&quot;</span><span style="color:#D4D4D4;">: [</span><span style="color:#CE9178;">&quot;rbf&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;poly&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;sigmoid&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;linear&quot;</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"><span style="color:#D4D4D4;">grid = GridSearchCV(SVC(), param_grid, </span><span style="color:#9CDCFE;">refit</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">grid.fit(X_train, y_train)</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(grid.best_params_)</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(grid.best_estimator_)</span></span>
<span class="line"><span style="color:#D4D4D4;">grid_predictions = grid.predict(X_test)</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(confusion_matrix(y_test, grid_predictions))</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(classification_report(y_test, grid_predictions))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Plot</span></span>
<span class="line"><span style="color:#D4D4D4;">sns.heatmap(confusion_matrix(y_test, grid_predictions), </span><span style="color:#9CDCFE;">annot</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">cmap</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;Blues&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">plt.show()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Save model</span></span>
<span class="line"><span style="color:#D4D4D4;">joblib.dump(grid, </span><span style="color:#CE9178;">&quot;model/svm.pkl&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p>本次测试每个类别 116 个样本，训练集 80%，测试集 20%，最终结果如下。</p><p>最优参数：</p><table><thead><tr><th>C</th><th>gamma</th><th>kernel</th></tr></thead><tbody><tr><td>10</td><td>1</td><td><code>rbf</code></td></tr></tbody></table><table><thead><tr><th>参数表</th><th>precision</th><th>recall</th><th>f1-score</th><th>support</th></tr></thead><tbody><tr><td>0.0</td><td>0.91</td><td>0.95</td><td>0.93</td><td>21</td></tr><tr><td>1.0</td><td>0.96</td><td>0.92</td><td>0.94</td><td>26</td></tr><tr><td>accuracy</td><td>-</td><td>-</td><td>0.94</td><td>47</td></tr><tr><td>macro avg</td><td>0.93</td><td>0.94</td><td>0.94</td><td>47</td></tr><tr><td>weighted avg</td><td>0.94</td><td>0.94</td><td>0.94</td><td>47</td></tr></tbody></table><p>混淆矩阵：</p><p><img src="/vuepress-opencv-notes/assets/matrix-c88bf42b.svg" alt="matrix" loading="lazy"></p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="footnote1" class="footnote-item"><p>一文了解通用行为识别 Action Recognition：了解及分类，<a href="https://zhuanlan.zhihu.com/p/103566134" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/103566134<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> <a href="#footnote-ref1" class="footnote-backref">↩︎</a></p></li><li id="footnote2" class="footnote-item"><p>Johansson, G. Visual perception of biological motion and a model for its analysis. <em>Perception &amp; Psychophysics</em> 14, 201–211 (1973). <a href="https://doi.org/10.3758/BF03212378" target="_blank" rel="noopener noreferrer">https://doi.org/10.3758/BF03212378<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> <a href="#footnote-ref2" class="footnote-backref">↩︎</a></p></li><li id="footnote3" class="footnote-item"><p>姿态估计与行为识别（行为检测、行为分类）的区别，<a href="https://cloud.tencent.com/developer/article/2029260" target="_blank" rel="noopener noreferrer">https://cloud.tencent.com/developer/article/2029260<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> <a href="#footnote-ref3" class="footnote-backref">↩︎</a></p></li><li id="footnote4" class="footnote-item"><p><em>YOLO-Pose: Enhancing YOLO for Multi Person Pose Estimation Using Object Keypoint Similarity Loss</em>，<a href="https://arxiv.org/abs/2204.06806" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2204.06806<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> <a href="#footnote-ref4" class="footnote-backref">↩︎</a> <a href="#footnote-ref4:1" class="footnote-backref">↩︎</a></p></li><li id="footnote5" class="footnote-item"><p><em>Rethinking Keypoint Representations: Modeling Keypoints and Poses as Objects for Multi-Person Human Pose Estimation</em>，<a href="https://arxiv.org/abs/2111.08557" target="_blank" rel="noopener noreferrer">https://arxiv.org/abs/2111.08557<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> <a href="#footnote-ref5" class="footnote-backref">↩︎</a></p></li><li id="footnote6" class="footnote-item"><p>YOLOv7-Pose，GitHub，<a href="https://github.com/WongKinYiu/yolov7/tree/pose" target="_blank" rel="noopener noreferrer">https://github.com/WongKinYiu/yolov7/tree/pose<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> <a href="#footnote-ref6" class="footnote-backref">↩︎</a></p></li><li id="footnote7" class="footnote-item"><p>YOLOv8，GitHub，<a href="https://github.com/ultralytics/ultralytics" target="_blank" rel="noopener noreferrer">https://github.com/ultralytics/ultralytics<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> <a href="#footnote-ref7" class="footnote-backref">↩︎</a></p></li><li id="footnote8" class="footnote-item"><p>在 Python 中使用机器学习进行人体姿势估计，深度学习与计算机视觉——微信公众号，<a href="https://mp.weixin.qq.com/s/D_sTpTp_pkLeO2nrcjgpaA" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/D_sTpTp_pkLeO2nrcjgpaA<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> <a href="#footnote-ref8" class="footnote-backref">↩︎</a></p></li></ol></section></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/Sun-ZhenXing/vuepress-opencv-notes//edit/main/docs/awesome/yolov5-pose/index.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页"><!--[--><!--]--> 在 GitHub 上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1006925066@qq.com">Sun-ZhenXing</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/vuepress-opencv-notes/assets/app-e9203006.js" defer></script>
  </body>
</html>
